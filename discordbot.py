# -*- coding: utf-8 -*-

import datetime
import os
import random

import discord
from discord.ext import tasks

DISCORD_BOT_ACCESS_TOKEN = os.environ["DISCORD_BOT_ACCESS_TOKEN"]  # Ê∂à„Åô„Å™

TEIREIKAI_CHANNEL_ID = 1056866893232885760  # ÂÆö‰æã‰ºö„ÉÅ„É£„É≥„Éç„É´ID
TEST_CHANNEL_ID = 1056870243739381810  # „ÅÑ„Éº„Å†„ÉÅ„É£„É≥„Éç„É´ID
KEIEIJIN_CHANNEL_ID = 1092709824661295175  # ÁµåÂñ∂Èô£„ÉÅ„É£„É≥„Éç„É´ID
KAISEKI_CHANNEL_ID = 1146443598783594536

SMILE_ICON = "\N{Smiling Face with Open Mouth and Smiling Eyes}"
CIRCLE_ICON = "\N{Heavy Large Circle}"
CROSS_ICON = "\N{CROSS MARK}"


intents = discord.Intents.all()
client = discord.Client(intents=intents)

da_mention = "<@&1060233582351757454>"
keiei_mention = "<@&1056864581517070449>"


@client.event
async def on_ready():
    loop.start()  # Bot„ÅåÊ∫ñÂÇôÂÆå‰∫Ü„Åó„ÅüÂ†¥Âêà
    print("„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„Åü")
    print("----------")
    await client.change_presence(activity=discord.Game(name="ÂÆö‰æã‰ºö", type=3))


# Ââç‰Ωø„Å£„Å¶„Åü„ÇÑ„Å§„ÅÆÊÆãÈ™∏
MORNING_GREETINGS = [
    "‰ªäÊúù„ÅØ„Çà„ÅèÁú†„Çå„Åæ„Åó„Åü„ÅãÔºü",
    "Êúù„ÅØ„Ç≥„Éº„Éí„Éº„Åß„ÇÇÈ£≤„Åø„Åæ„Åó„Çá„ÅÜÔºÅ",
    "‰ªäÊó•„ÇÇ‰∏ÄÊó•È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ",
    "Êô¥„Çå„Å¶„ÅÑ„Åü„ÇâÂ§™ÈôΩ„ÅÆÂÖâ„ÇíÊµ¥„Å≥„Åæ„Åó„Çá„ÅÜÔºÅ",
    "Ê•Ω„Åó„ÅÑ‰∏ÄÊó•„ÅÆÂßã„Åæ„Çä„Åß„ÅôÔºÅ",
    "ËÉå‰º∏„Å≥„Çí„Åó„Å¶„É™„É©„ÉÉ„ÇØ„Çπ„Åó„Åæ„Åó„Çá„ÅÜÔºÅ",
]

AFTERNOON_GREETINGS = [
    "Ë™øÂ≠ê„ÅØ„ÅÑ„Åã„Åå„Åß„Åô„ÅãÔºü",
    "ËÉå‰º∏„Å≥„Çí„Åó„Å¶„É™„É©„ÉÉ„ÇØ„Çπ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ",
    "‰ªäÊó•„ÇÇ„ÅÇ„Å®ÂçäÂàÜÔºÅÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ",
    "Êô¥„Çå„Å¶„ÅÑ„Åü„ÇâÂ§™ÈôΩ„ÅÆÂÖâ„ÇíÊµ¥„Å≥„Åæ„Åó„Çá„ÅÜÔºÅ",
    "Áú†Ê∞ó„Å´Ë≤†„Åë„Å™„ÅÑ„ÅßÔºÅÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ",
    "‰ªäÊó•„ÅØ„ÅÑ„ÅÑ„Åì„Å®„Åå„ÅÇ„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„ÇìÔºÅ",
]

EVENING_GREETINGS = [
    "‰ªäÊó•„ÇÇ‰∏ÄÊó•„ÅäÁñ≤„ÇåÊßò„Åß„Åô",
    "Â§ú„ÅØ„É™„É©„ÉÉ„ÇØ„Çπ„Åó„Åæ„Åó„Çá„ÅÜÔºÅ",
    "‰ªäÊó•„ÅØ„ÅÑ„ÅÑ„Åì„Å®„ÅÇ„Çä„Åæ„Åó„Åü„ÅãÔºü",
    "(-_-)zzz",
    "ÁßÅ„ÅÆÂÆ∂„Åã„ÇâË¶ã„Åà„ÇãÂ§úÊôØ„ÅØ„Å®„Å¶„ÇÇ„Åç„Çå„ÅÑ„Åß„Åô‚ô™",
    "ÊÅØÊäú„Åç„Çí„Åó„Åæ„Åó„Çá„ÅÜÔºÅ",
]


@client.event
async def reply(message: discord.Message):
    dt = datetime.datetime.utcnow() + datetime.timedelta(hours=9)  # Êó•Êú¨„Å®„ÅÆÊôÇÂ∑Æ
    hr = int(dt.hour)
    rd01 = random.choice(MORNING_GREETINGS)
    rd02 = random.choice(AFTERNOON_GREETINGS)
    rd03 = random.choice(EVENING_GREETINGS)

    if hr >= 17 or hr < 5:
        await message.channel.send(f"„Åì„Çì„Å∞„Çì„ÅØ„ÄÅ{message.author.mention}„Åï„ÇìÔºÅ{rd03}")
    if hr >= 11 and hr < 17:
        await message.channel.send(f"„Åì„Çì„Å´„Å°„ÅØ„ÄÅ{message.author.mention}„Åï„ÇìÔºÅ{rd02}")
    if hr >= 5 and hr < 11:
        await message.channel.send(f"„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÅ{message.author.mention}„Åï„ÇìÔºÅ{rd01}")


@client.event
async def on_message(message: discord.Message):
    mentioned_users = [user and user.id for user in message.mentions]

    # „Éú„ÉÉ„ÉàËá™Ë∫´„Åå„É°„É≥„Ç∑„Éß„É≥„Åï„Çå„Åü„Åã„Å©„ÅÜ„Åã„ÇíÁ¢∫Ë™ç
    if (client.user and client.user.id) in mentioned_users:
        await reply(message)

    # „Éú„ÉÉ„ÉàËá™Ë∫´„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Å´„ÅØÂèçÂøú„Åó„Å™„ÅÑ
    if message.author.bot:
        return

    # DAÁ†î„Å®„ÅÑ„ÅÜ„É°„ÉÉ„Çª„Éº„Ç∏„Å´ÂèçÂøú
    if message.content == "DAÁ†î":
        da_ans = await message.channel.send("DAÁ†î„Éú„ÉÉ„Éà„Å†„ÇàÔºÅ")
        await message.channel.send("üòÜ")
        await da_ans.add_reaction(SMILE_ICON)

    # test„Åã„ÇâÂßã„Åæ„Çã„É°„ÉÉ„Çª„Éº„Ç∏„Å´ÂèçÂøú
    if message.content.startswith("/test_teirei"):
        embed = discord.Embed(
            title="**ÂÆö‰æã‰ºö„ÅåÈñãÂÇ¨„Åï„Çå„Åæ„ÅôÔºÅ**",
            description="**16:30ÔΩû**ÂÆö‰æã‰ºö„Åå„ÅÇ„Çä„Åæ„ÅôÔºÅ\n „Åø„Çì„Å™ÈõÜÂêàÔºÅ",
            color=discord.Colour.from_rgb(0, 132, 234),
        )

        embed.set_thumbnail(
            url="https://c.tenor.com/KChHVc7BktYAAAAd/discord-loading.gif"
        )
        emb = await message.channel.send(embed=embed)
        await emb.add_reaction(CIRCLE_ICON)
        await emb.add_reaction(CROSS_ICON)

    if message.content.startswith("/test_keiei"):
        embed = discord.Embed(
            title="**(Ë©¶)ÂÆö‰æã‰ºö„ÅÆË≥áÊñôË®òÂÖ•„Å´„Å§„ÅÑ„Å¶**",
            description=f"{keiei_mention} 16:30ÔΩûÂÆö‰æã‰ºö\nË≥áÊñôË®òÂÖ•„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô\n",
            color=discord.Colour.from_rgb(0, 132, 234),
        )
        embed.set_image(url="https://c.tenor.com/KChHVc7BktYAAAAd/discord-loading.gif")
        embed.add_field(
            name="ÂÆö‰æã‰ºöË≥áÊñô‰ΩúÊàê„Éï„Ç©„Éº„É†‚Üì", value="https://pptx-maker.uoh-dakken.com/#/"
        )
        await message.channel.send(embed=embed)

    if message.content == "ÂÖµÂ∫´Áúå":
        send_message = "Japan Plane Rectangular CS V"
        await message.channel.send(send_message)


@tasks.loop(minutes=1)
async def loop():
    await client.wait_until_ready()
    dt = datetime.datetime.utcnow() + datetime.timedelta(hours=9)
    week = int(dt.isoweekday())
    # Êó•Êú¨„Å®„ÅÆÊôÇÂ∑Æ
    hr = int(dt.hour)
    min = int(dt.minute)
    # ÁèæÂú®„ÅÆÊó•‰ªò„Å®ÊôÇÂàª„ÇíÂèñÂæó
    month = dt.month
    day = dt.day
    week_list = ["Êúà", "ÁÅ´", "Ê∞¥", "Êú®", "Èáë", "Âúü", "Êó•"]  # ÊúàÊõúÊó•„Åå1

    await client.wait_until_ready()

    if week == 4 and hr == 15 and min == 00:  # ÂÆö‰æã‰ºö„Åä„Åó„Çâ„Åõembed
        channel = client.get_channel(TEIREIKAI_CHANNEL_ID)
        if not isinstance(channel, discord.TextChannel):
            return
        description = (
            f"{da_mention} **{month}**Êúà**{day}**Êó•(**{week_list[week-1]}**)\n"
            "**16:30ÔΩû**ÂÆö‰æã‰ºö„Åå„ÅÇ„Çä„Åæ„ÅôÔºÅ\n"
            "„Åø„Çì„Å™ÈõÜÂêàÔºÅ"
        )
        embed = discord.Embed(
            title="**ÂÆö‰æã‰ºö„ÅåÈñãÂÇ¨„Åï„Çå„Åæ„ÅôÔºÅ**",
            description=description,
            color=discord.Colour.from_rgb(0, 132, 234),
        )
        embed.set_thumbnail(
            url="https://c.tenor.com/KChHVc7BktYAAAAd/discord-loading.gif"
        )
        await channel.send(embed=embed)

    if week == 4 and hr == 16 and min == 30:  # ÂÆö‰æã‰ºöÈñãÂßãembed
        channel = client.get_channel(TEIREIKAI_CHANNEL_ID)
        if not isinstance(channel, discord.TextChannel):
            return
        description = f"{da_mention} **{month}**Êúà**{day}**Êó•(**{week_list[week-1]}**)ÂÆö‰æã‰ºö"
        embed = discord.Embed(
            title="**ÂÆö‰æã‰ºö„ÇíÈñãÂßã„Åó„Åæ„ÅôÔºÅ**",
            description=description,
            color=discord.Colour.from_rgb(0, 132, 234),
        )
        embed.set_thumbnail(
            url="https://c.tenor.com/KChHVc7BktYAAAAd/discord-loading.gif"
        )
        await channel.send(embed=embed)

    if week == 4 and hr == 9 and min == 00:  # ÂÆö‰æã‰ºöË≥áÊñôË®òÂÖ•_ÁµåÂñ∂Èô£embed
        channel = client.get_channel(KEIEIJIN_CHANNEL_ID)
        if not isinstance(channel, discord.TextChannel):
            return

        embed = discord.Embed(
            title="**ÂÆö‰æã‰ºö„ÅÆË≥áÊñôË®òÂÖ•„Å´„Å§„ÅÑ„Å¶**",
            description=f"{keiei_mention} Êú¨Êó•16:30ÔΩûÂÆö‰æã‰ºö„Åß„Åô„ÄÇ\nÂêÑËá™„ÄÅË≥áÊñôË®òÂÖ•„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô\n",
            color=discord.Colour.from_rgb(0, 132, 234),
        )
        embed.add_field(
            name="ÂÆö‰æã‰ºöË≥áÊñô‰ΩúÊàê„Éï„Ç©„Éº„É†‚Üì", value="https://pptx-maker.uoh-dakken.com/#/"
        )
        await channel.send(embed=embed)

    if week == 4 and hr == 20 and min == 00:  # Ëß£Êûê„Ç≥„É≥„ÉöÂá∫Ê¨†embed
        kaiseki_dt = dt + datetime.timedelta(days=7)
        kaiseki_week = int(kaiseki_dt.isoweekday())
        channel = client.get_channel(KAISEKI_CHANNEL_ID)
        if not isinstance(channel, discord.TextChannel):
            return
        embed = discord.Embed(
            title=f"**{kaiseki_dt.month}**/**{kaiseki_dt.day}**({week_list[kaiseki_week-1]})Ëß£Êûê„Ç≥„É≥„ÉöÂá∫Ê¨†Ë™øÊüª",
            description=f"{da_mention} Ê¨°Âõû„ÅÆ‰ºöË≠∞„Å´ \n Âá∫Â∏≠ ‚áí {CIRCLE_ICON}   Ê¨†Â∏≠ ‚áí {CROSS_ICON}",
            color=discord.Colour.from_rgb(97, 216, 70),
        )
        embed.set_thumbnail(
            url="https://cdn.dribbble.com/users/1751759/screenshots/5460650/wifi_happiness.gif"
        )
        emb = await channel.send(embed=embed)
        await emb.add_reaction(CIRCLE_ICON)
        await emb.add_reaction(CROSS_ICON)


@client.event
async def on_member_join(member: discord.Member):  # Êñ∞Ë¶è„É¶„Éº„Ç∂„ÉºÂèÇÂä†ÊôÇ
    channel = client.get_channel(TEST_CHANNEL_ID)
    if isinstance(channel, discord.TextChannel):
        embed = discord.Embed(
            title="**„Çµ„Éº„Éê„Éº„ÅÆÂÖ•ÂÆ§„ÇíÊ§úÁü•„Åó„Åæ„Åó„Åü**",
            description="welcome to Dakken discord channel!",
            color=discord.Colour.from_rgb(0, 132, 234),
        )
        await channel.send(embed=embed)


client.run(DISCORD_BOT_ACCESS_TOKEN)
